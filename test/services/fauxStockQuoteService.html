<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Strict//EN" "http://www.w3.org/TR/html4/strict.dtd">
	<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Faux StockQuoteService Test</title>
		
		<!-- Logging -->
		<script src="../../external/src/json2.js"></script>
		<script src="../../src/logging/Logger.js"></script>
		<script src="../../src/logging/ConsoleLogger.js"></script>
		
		<!-- services related -->
		<script src="../../src/Event.js"></script>
		<script src="../../src/EventPublisher.js"></script>
		<script src="../../src/services/Service.js"></script>
		<script src="../../src/services/PollingService.js"></script>
		<script src="./StockQuoteService.js"></script>
		
		<script src="./StockQuoteController.js"></script>
		<script src="./StockQuoteView.js"></script>
		
		<script>
			var log = new ConsoleLogger( "fauxStockQuoteService.html" );
			log.setJsonService( JSON );
			
			var eventDispatcher = new EventPublisher();
			var stockQuoteService = new StockQuoteService( eventDispatcher, "refreshRates.stock", 3000 );
			var watchlistStockQuoteService = new StockQuoteService( eventDispatcher, "refreshRates.watchlist", 5000 );
			var stockQuote = new StockQuoteController( stockQuoteService, new StockQuoteView( "stockQuoteView" ) );
			var stockQuote2 = new StockQuoteController( stockQuoteService, new StockQuoteView( "stockQuoteView2" ) );
			var watchlist = new StockQuoteController( watchlistStockQuoteService, new StockQuoteView( "watchlist" ) );
			
			function stockQuoteFactory( quoteService, idSuffix ) {
				return new StockQuoteController( quoteService, new StockQuoteView( idSuffix ) );
			}
			
			var stockQuotes = [];
			
			window.onload = function() {
				document.getElementById( "streaming-toggle" ).onclick = function() {
					if ( this.checked ) {
						eventDispatcher.publish( "startUpdates" );
					}
					else {
						eventDispatcher.publish( "stopUpdates" );
					}
				};
				
				document.getElementById( "refreshRates-button" ).onclick = function() {
					var rate = Number( document.getElementById( "refreshRates-input" ).value );
					var type = document.getElementById( "refreshRates-type" ).value;
					
					if ( "stock" === type ) {
						eventDispatcher.publish( "pollingPeriodChanged", {
							"refreshRates.stock": rate
						} );
					}
					else if ( "watchlist" === type ) {
						eventDispatcher.publish( "pollingPeriodChanged", {
							"refreshRates.watchlist": rate
						} );
					}
				};
				
				var div = null;
				
				for ( var i = 0, length = 100; i < length; i++ ) {
					div = document.createElement( "div" );
					div.className = "stockQuote";
					div.id = "stockQuote-" + i;
					document.body.appendChild( div );
					
					stockQuotes[ i ] = stockQuoteFactory( stockQuoteService, "stockQuote-" + i );
					stockQuotes[ i ].init( "MSFT" );
				}
				
				stockQuote.init( "GE" );
				stockQuote2.init( "GOOG" );
				watchlist.init( "BRK.A" );
				stockQuoteService.init();
				watchlistStockQuoteService.init();
			};
		</script>
		
		<style>
			body {
				font-family: Arial, Helvetica, sans-serif;
				font-size: 80%;
				margin: 0;
				padding: 0;
			}

			.stockQuote {
				float: left;
				margin-left: 1em;
				width: 150px;
			}

			.stockQuote table {
				font-size: 1em;
				width: 100%;
			}
			
			#topBar {
				background-color: #e0e0e0;
				border-bottom: 1px solid #505050;
				margin-bottom: 1em;
				padding: 1em 12px;
			}
			
			.topBarContainer {
				padding-right: 2em;
			}
		</style>
	</head>
	<body>
		<div id="topBar">
			<span class="topBarContainer">
				<input type="checkbox" id="streaming-toggle" checked> Streaming
			</span>
			
			<span class="topBarContainer">
				Refresh rate (ms): <input type="text" value="3000" size="4" id="refreshRates-input">
				<select id="refreshRates-type">
					<option value="stock">Stocks</option>
					<option value="watchlist">Watchlists</option>
				</select>
				<button id="refreshRates-button">Set</button>
			</span>
		</div>
		
		<div class="stockQuote" id="stockQuoteView"></div>
		<div class="stockQuote" id="stockQuoteView2"></div>
		<div class="stockQuote" id="watchlist"></div>
	</body>
</html>