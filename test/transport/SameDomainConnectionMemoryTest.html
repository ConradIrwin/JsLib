<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>SameDomainConnectionMemoryTest</title>
	<script src="../../src/Delegator.js"></script>
	<script src="../../src/transport/Connection.js"></script>
	<script src="../../src/transport/SameDomainConnection.js"></script>
	<script>
		var timerId = null;
		var period = 200;
		var connection = null;
		
		function handleTimerExpired() {
			timerId = null;
			connection.send();
		}
		
		function startTimer() {
			if ( timerId !== null ) {
				return;
			}
			
			timerId = setTimeout( handleTimerExpired, period );
		}
		
		function stopTimer() {
			if ( timerId === null ) {
				return;
			}
			
			clearTimeout( timerId );
			connection.abort();
			timerId = null;
		}
		
		window.onload = function() {
			connection = new SameDomainConnection();
			
			connection.setOptions( {
				url: "./dummy.txt",
				method: SameDomainConnection.METHOD_GET,
				dataType: SameDomainConnection.DATA_TYPE_HTML,
				actions: {
					success: { instance: window, method: "startTimer" },
					error: { instance: window, method: "stopTimer" }
				}
			} );
			
			connection.send();
		};
	</script>
</head>
<body>
	<h1>SameDomainConnection Memory Test</h1>
	
	<p>
		This is just a brute force memory leak test. In Windows, open up the Task Manager.
		On a Macintosh, open the Activity Monitor. Monitor the brower's process. Memory
		usage should be relatively stagnant. It's normal to see memory usage rise a tad,
		then fall as the browser's garbage collector kicks in and frees up memory that is
		no longer being referenced by JavaScript variables.
	</p>
</body>
</html>
